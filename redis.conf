# Redis configuration for AutoSocioly
# This configuration is optimized for caching and session storage

# Network configuration
bind 0.0.0.0
port 6379
protected-mode no

# Memory management
maxmemory 256mb
maxmemory-policy allkeys-lru
maxmemory-samples 5

# Persistence configuration (RDB snapshots)
save 900 1      # Save after 900 seconds if at least 1 key changed
save 300 10     # Save after 300 seconds if at least 10 keys changed
save 60 10000   # Save after 60 seconds if at least 10000 keys changed

# RDB file configuration
dbfilename dump.rdb
dir /data

# AOF (Append Only File) configuration for additional persistence
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Logging
loglevel notice
logfile ""

# Client configuration
timeout 0
tcp-keepalive 300
tcp-backlog 511

# Security (disable dangerous commands)
rename-command FLUSHDB ""
rename-command FLUSHALL ""

# Performance tuning
databases 16
hz 10
dynamic-hz yes

# Memory optimization
activedefrag yes
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 100
active-defrag-cycle-min 5
active-defrag-cycle-max 75

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Replication (disabled for single instance)
# replica-serve-stale-data yes
# replica-read-only yes

# Key eviction policies for different use cases
# volatile-lru: Evict keys with expiry set using LRU
# allkeys-lru: Evict any key using LRU (our default)
# volatile-random: Evict keys with expiry set randomly
# allkeys-random: Evict any key randomly
# volatile-ttl: Evict keys with expiry set and shortest TTL
# noeviction: Never evict keys, return error on memory limit

# Slow log configuration
slowlog-log-slower-than 10000
slowlog-max-len 128

# Latency monitoring
latency-monitor-threshold 100